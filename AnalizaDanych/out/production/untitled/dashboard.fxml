<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.BarChart?>
<?import javafx.scene.chart.CategoryAxis?>
<?import javafx.scene.chart.NumberAxis?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>

<BorderPane prefHeight="720.0" prefWidth="1100.0" xmlns="http://javafx.com/javafx/11.0.1" xmlns:fx="http://javafx.com/fxml/1" fx:controller="pl.analiza.controller.DashboardController">

    <top>
        <HBox spacing="20" alignment="CENTER_LEFT" style="-fx-background-color: #2c3e50; -fx-padding: 15;">
            <Label text="ANALIZA DANYCH" textFill="white">
                <font><Font name="System Bold" size="18.0"/></font>
                <HBox.margin><Insets right="30"/></HBox.margin>
            </Label>

            <Button text="ðŸ“‚ Wczytaj CSV" onAction="#handleImportCSV"
                    style="-fx-background-color: #34495e; -fx-text-fill: white; -fx-cursor: hand; -fx-background-radius: 5;"/>

            <Button text="ðŸ“‚ Wczytaj Excel" onAction="#handleImportExcel"
                    style="-fx-background-color: #34495e; -fx-text-fill: white; -fx-cursor: hand; -fx-background-radius: 5;"/>

            <Region HBox.hgrow="ALWAYS" />

            <Button text="ðŸ’¾ ZAPISZ DO BAZY" onAction="#handleSaveToDB"
                    style="-fx-background-color: #27ae60; -fx-text-fill: white; -fx-font-weight: bold; -fx-cursor: hand; -fx-background-radius: 5; -fx-padding: 8 20 8 20;"/>

            <Button text="âŒ WyjÅ›cie" onAction="#handleExit"
                    style="-fx-background-color: #c0392b; -fx-text-fill: white; -fx-cursor: hand; -fx-background-radius: 5;"/>
        </HBox>
    </top>

    <left>
        <VBox spacing="10.0" style="-fx-background-color: #f8f9fa; -fx-padding: 15; -fx-pref-width: 300; -fx-border-color: #dee2e6; -fx-border-width: 0 1 0 0;">
            <Label text="Edycja Produktu" style="-fx-font-weight: bold; -fx-font-size: 16px; -fx-text-fill: #2c3e50;" />
            <Separator />

            <VBox spacing="5">
                <Label text="Nazwa produktu:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                <TextField fx:id="txtProduct" promptText="Wpisz nazwÄ™..." />
            </VBox>

            <VBox spacing="5">
                <Label text="Kategoria:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                <TextField fx:id="txtCategory" promptText="Wpisz kategoriÄ™..." />
            </VBox>

            <GridPane hgap="10" vgap="10">
                <columnConstraints>
                    <ColumnConstraints percentWidth="50"/>
                    <ColumnConstraints percentWidth="50"/>
                </columnConstraints>
                <VBox spacing="5" GridPane.columnIndex="0">
                    <Label text="IloÅ›Ä‡:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                    <TextField fx:id="txtQuantity" promptText="0" />
                </VBox>
                <VBox spacing="5" GridPane.columnIndex="1">
                    <Label text="Cena (PLN):" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                    <TextField fx:id="txtPrice" promptText="0.00" />
                </VBox>
            </GridPane>

            <CheckBox fx:id="chkAvailable" text="DostÄ™pny w sprzedaÅ¼y" style="-fx-padding: 5 0 5 0;"/>

            <HBox spacing="10" alignment="CENTER">
                <Button text="WyczyÅ›Ä‡" onAction="#handleClear" prefWidth="100" style="-fx-cursor: hand;"/>
                <Button text="ZatwierdÅº" onAction="#handleAddOrUpdate" style="-fx-base: #2980b9; -fx-text-fill: white; -fx-font-weight: bold; -fx-cursor: hand;" prefWidth="100"/>
            </HBox>
            <Button text="UsuÅ„ zaznaczony" onAction="#handleDelete" style="-fx-base: #e74c3c; -fx-text-fill: white; -fx-cursor: hand;" maxWidth="Infinity"/>

            <Separator />
            <Label fx:id="lblStatus" text="Gotowy." wrapText="true" style="-fx-text-fill: #7f8c8d; -fx-font-style: italic; -fx-font-size: 11px;"/>
        </VBox>
    </left>

    <center>
        <TabPane fx:id="mainTabPane" tabClosingPolicy="UNAVAILABLE" style="-fx-background-color: white;">
            <tabs>
                <Tab text="Produkty (Magazyn)">
                    <content>
                        <VBox spacing="10">
                            <padding><Insets top="10" right="10" bottom="10" left="10"/></padding>
                            <HBox spacing="10" alignment="CENTER_LEFT" style="-fx-background-color: #ecf0f1; -fx-padding: 8; -fx-background-radius: 5;">
                                <Label text="ðŸ” Filtrowanie:" style="-fx-font-weight: bold;"/>
                                <TextField fx:id="txtSearch" promptText="Szukaj po nazwie lub kategorii..." HBox.hgrow="ALWAYS"/>
                            </HBox>
                            <TableView fx:id="tableView" VBox.vgrow="ALWAYS">
                                <columns>
                                    <TableColumn fx:id="colProduct" text="Produkt" prefWidth="150"/>
                                    <TableColumn fx:id="colCategory" text="Kategoria" prefWidth="120"/>
                                    <TableColumn fx:id="colQuantity" text="IloÅ›Ä‡" prefWidth="80"/>
                                    <TableColumn fx:id="colPrice" text="Cena" prefWidth="100"/>
                                    <TableColumn fx:id="colAvailable" text="DostÄ™pnoÅ›Ä‡" prefWidth="100"/>
                                </columns>
                                <columnResizePolicy><TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/></columnResizePolicy>
                            </TableView>
                        </VBox>
                    </content>
                </Tab>

                <Tab text="Kategorie (SÅ‚ownik)">
                    <content>
                        <HBox spacing="15">
                            <padding><Insets top="15" right="15" bottom="15" left="15"/></padding>
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="Lista Kategorii (Baza Danych):" style="-fx-font-weight: bold;"/>
                                <ListView fx:id="listCategories" VBox.vgrow="ALWAYS"/>
                            </VBox>
                            <VBox spacing="10" minWidth="250" style="-fx-background-color: #fff; -fx-padding: 10; -fx-border-color: #bdc3c7; -fx-border-radius: 5;">
                                <Label text="ZarzÄ…dzanie:" style="-fx-font-weight: bold; -fx-font-size: 14px; -fx-text-fill: #2c3e50;"/>
                                <TextField fx:id="txtNewCategory" promptText="Nazwa kategorii..."/>
                                <HBox spacing="5">
                                    <Button text="Dodaj" onAction="#handleAddCategory" style="-fx-base: #27ae60; -fx-text-fill: white;" maxWidth="Infinity" HBox.hgrow="ALWAYS"/>
                                    <Button text="ZmieÅ„ nazwÄ™" onAction="#handleEditCategory" style="-fx-base: #2980b9; -fx-text-fill: white;" maxWidth="Infinity" HBox.hgrow="ALWAYS"/>
                                </HBox>
                                <Separator/>
                                <Button text="UsuÅ„ wybranÄ…" onAction="#handleDeleteCategory" style="-fx-base: #c0392b; -fx-text-fill: white;" maxWidth="Infinity"/>
                                <Label text="Uwaga: Zmiana nazwy lub usuniÄ™cie wpÅ‚ywa na wszystkie powiÄ…zane produkty!" wrapText="true" style="-fx-font-size: 10px; -fx-text-fill: #e67e22; -fx-font-weight: bold;"/>
                            </VBox>
                        </HBox>
                    </content>
                </Tab>

                <Tab text="Wizualizacja">
                    <content>
                        <VBox alignment="CENTER" spacing="10">
                            <padding><Insets top="10" right="10" bottom="10" left="10"/></padding>
                            <HBox alignment="CENTER" spacing="10">
                                <Label text="Dane na wykresie:" style="-fx-font-weight: bold;"/>
                                <ComboBox fx:id="comboChartType" prefWidth="200"/>
                            </HBox>
                            <BarChart fx:id="barChart" VBox.vgrow="ALWAYS">
                                <xAxis><CategoryAxis label="Produkt"/></xAxis>
                                <yAxis><NumberAxis fx:id="axisY" label="WartoÅ›Ä‡"/></yAxis>
                            </BarChart>
                        </VBox>
                    </content>
                </Tab>

                <Tab text="Statystyka i Raporty">
                    <content>
                        <VBox spacing="15" style="-fx-padding: 20; -fx-background-color: #f4f6f9;">

                            <HBox spacing="20" alignment="CENTER">
                                <VBox style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 8; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 5);" minWidth="200" alignment="CENTER">
                                    <Label text="CaÅ‚kowita WartoÅ›Ä‡ Magazynu" style="-fx-text-fill: #7f8c8d; -fx-font-size: 12px;"/>
                                    <Label fx:id="lblKpiTotalValue" text="0.00 PLN" style="-fx-text-fill: #27ae60; -fx-font-size: 24px; -fx-font-weight: bold;"/>
                                </VBox>
                                <VBox style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 8; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 5);" minWidth="200" alignment="CENTER">
                                    <Label text="Liczba ProduktÃ³w" style="-fx-text-fill: #7f8c8d; -fx-font-size: 12px;"/>
                                    <Label fx:id="lblKpiCount" text="0" style="-fx-text-fill: #2980b9; -fx-font-size: 24px; -fx-font-weight: bold;"/>
                                </VBox>
                                <VBox style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 8; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 5);" minWidth="200" alignment="CENTER">
                                    <Label text="Åšrednia Cena Rynkowa" style="-fx-text-fill: #7f8c8d; -fx-font-size: 12px;"/>
                                    <Label fx:id="lblKpiAvgPrice" text="0.00 PLN" style="-fx-text-fill: #e67e22; -fx-font-size: 24px; -fx-font-weight: bold;"/>
                                </VBox>
                            </HBox>

                            <Separator />

                            <SplitPane dividerPositions="0.6" VBox.vgrow="ALWAYS" style="-fx-background-color: transparent;">

                                <VBox spacing="10" style="-fx-padding: 0 10 0 0;">
                                    <Label text="SzczegÃ³Å‚y wg Kategorii" style="-fx-font-weight: bold; -fx-font-size: 14px; -fx-text-fill: #34495e;"/>
                                    <TableView fx:id="tableStats" VBox.vgrow="ALWAYS">
                                        <columns>
                                            <TableColumn fx:id="colStatCat" text="Kategoria" prefWidth="150"/>
                                            <TableColumn fx:id="colStatCount" text="IloÅ›Ä‡ Poz." prefWidth="80"/>
                                            <TableColumn fx:id="colStatAvg" text="Åšr. Cena" prefWidth="100"/>
                                            <TableColumn fx:id="colStatTotal" text="WartoÅ›Ä‡" prefWidth="120"/>
                                        </columns>
                                        <columnResizePolicy><TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/></columnResizePolicy>
                                    </TableView>
                                </VBox>

                                <VBox spacing="15" style="-fx-padding: 0 0 0 10;">
                                    <Label text="Kalkulator i Logi" style="-fx-font-weight: bold; -fx-font-size: 14px; -fx-text-fill: #34495e;"/>

                                    <VBox spacing="10" style="-fx-background-color: white; -fx-padding: 15; -fx-border-color: #bdc3c7; -fx-border-radius: 5;">
                                        <Label text="Szybkie obliczenia:" style="-fx-font-weight: bold; -fx-font-size: 12px;"/>
                                        <HBox spacing="5">
                                            <ComboBox fx:id="comboStatsField" promptText="Pole" maxWidth="Infinity" HBox.hgrow="ALWAYS"/>
                                            <ComboBox fx:id="comboStatsOp" promptText="Operacja" maxWidth="Infinity" HBox.hgrow="ALWAYS"/>
                                        </HBox>
                                        <Button text="Oblicz" onAction="#handleCalculateSingle" maxWidth="Infinity" style="-fx-base: #34495e; -fx-text-fill: white;"/>
                                    </VBox>

                                    <Label text="Historia operacji:" style="-fx-font-weight: bold; -fx-font-size: 12px;"/>
                                    <TextArea fx:id="txtStatsLog" VBox.vgrow="ALWAYS" editable="false" style="-fx-font-family: 'Consolas', monospace;"/>

                                    <HBox spacing="5">
                                        <Button text="Generuj Raport TXT" onAction="#handleCalculateReport" maxWidth="Infinity" HBox.hgrow="ALWAYS"/>
                                        <Button text="WyczyÅ›Ä‡" onAction="#handleClearStats" maxWidth="Infinity" HBox.hgrow="ALWAYS"/>
                                    </HBox>
                                </VBox>
                            </SplitPane>
                        </VBox>
                    </content>
                </Tab>
            </tabs>
        </TabPane>
    </center>

    <bottom>
        <HBox alignment="CENTER_RIGHT" style="-fx-padding: 5; -fx-background-color: #ecf0f1; -fx-border-color: #bdc3c7; -fx-border-width: 1 0 0 0;">
            <Label text="System Analizy Danych v3.5 - Bartosz Bieszczak" style="-fx-text-fill: #7f8c8d; -fx-font-size: 10px;" />
        </HBox>
    </bottom>
</BorderPane>